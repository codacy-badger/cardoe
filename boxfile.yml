run.config:
  engine: php
  engine.config:
    runtime: php-7.2
    document_root: tests/testbed
    extensions:
      - apcu
      - ctype
      - curl
      - dom
      - fileinfo
      - gd
      - iconv
      - json
      - mbstring
      - phar
      - simplexml
      - tokenizer
      - yaml
      - xml
      - xmlwriter
      - zip
      - zlib
    zend_extensions:
      - opcache
    dev_zend_extensions:
      add:
        - xdebug
      rm:
        - opcache
  extra_packages:
    - autoconf
  extra_steps:
    #===========================================================================
    # AST extension compilation
    - |
      (
        CURRENT_FOLDER=$(pwd)
        rm -fR $CURRENT_FOLDER/php-ast
        cd $CURRENT_FOLDER
        git clone --depth=1 https://github.com/nikic/php-ast.git
        cd php-ast
        set -e
        phpize
        ./configure --with-php-config=$(which php-config)
        make -j"$(getconf _NPROCESSORS_ONLN)"
        make install
        cd $CURRENT_FOLDER
        rm -fR $CURRENT_FOLDER/php-ast
        unset CURRENT_FOLDER
      )
    - echo -e 'extension=ast.so' >> "/data/etc/php/dev_php.ini"
    #===========================================================================

